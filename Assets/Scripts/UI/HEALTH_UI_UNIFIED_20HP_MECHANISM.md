# 🩸 血量UI统一20HP机制说明

## 🎯 核心设定

**所有心形血量统一为20HP，心形类型仅为视觉差异！**

- ❤️ **红心**: 20HP（基础视觉）
- 💛 **金心**: 20HP（升级视觉，功能相同）
- 💎 **水晶心**: 20HP（高级视觉，功能相同）

## 📐 心形升级规则

### 视觉升级机制
- **400HP及以下**: 全部显示为红心
- **400HP以上**: 开始将前面的心形升级为金心视觉
- **升级计算**: `(maxHealth - 400) / 20 = 金心数量`
- **升级限制**: 最多升级10个（上排优先）

### 实际效果示例

| 血量上限 | 金心数量 | 红心数量 | 显示效果 |
|---------|---------|---------|---------|
| 100HP   | 0       | 5       | 5个红心 |
| 400HP   | 0       | 20      | 两排全红心 |
| 500HP   | 5       | 20      | 前5个金心+其余红心 |
| 600HP   | 10      | 20      | 上排10个金心+下排10个红心 |

## 🎮 血量减少机制

### 优先扣除规则
1. **从左到右扣除** - 优先扣除前面的心形
2. **金心优先** - 有金心时优先扣除金心
3. **每个心形20HP** - 无论颜色，每个都是20HP

### 扣血示例

**600HP → 580HP (扣除20HP)**
```
之前: [金心1满][金心2满]...[金心10满][红心1满]...[红心20满]
之后: [金心1空][金心2满]...[金心10满][红心1满]...[红心20满]
```

**600HP → 400HP (扣除200HP，即10个心形)**
```
之前: [金心1满][金心2满]...[金心10满][红心1满]...[红心20满]
之后: [金心1空][金心2空]...[金心10空][红心1满]...[红心20满]
```

## 🔧 技术实现

### 1. 心形类型分配
```csharp
// 计算金心数量
int upgradedHearts = 0;
if (maxHealth > 400f) {
    upgradedHearts = Mathf.FloorToInt((maxHealth - 400f) / 20f);
    upgradedHearts = Mathf.Min(upgradedHearts, 10); // 限制最多10个
}

// 分配类型：前upgradedHearts个为金心，其余为红心
```

### 2. 血量分配
```csharp
// 所有心形容量都是20HP
private float GetHeartCapacity(HeartType heartType) {
    return 20f; // 统一容量
}

// 从左到右优先分配血量给心形
```

### 3. 状态计算
```csharp
// 根据心形实际血量确定状态
if (currentHealth <= 0) return Empty;
if (currentHealth >= 20) return Full;
return currentHealth >= 10 ? Half : Empty; // 半血阈值=10HP
```

## 🧪 测试验证

使用以下测试菜单验证功能：

- **"测试: 基础血量(100HP)"** → 5个红心
- **"测试: 中级血量(400HP)"** → 20个红心
- **"测试: 高级血量(500HP)"** → 前5个金心+20个红心
- **"测试: 满级血量(600HP)"** → 前10个金心+20个红心
- **"测试: 扣血(600→580HP)"** → 优先从第一个金心扣除
- **"测试: 扣血(600→400HP)"** → 所有金心变空

## ✅ 关键优势

1. **逻辑简单** - 所有心形都是20HP，容易理解
2. **视觉丰富** - 金心提供视觉升级感
3. **扣血直观** - 从左到右优先扣除，符合直觉
4. **布局美观** - 上排金心下排红心的视觉层次

## 🔍 调试信息

修正后的调试输出：
```
[PlayerHealthUI] 心形类型分布 - 最大血量: 600, 需要心形: 30, 金心: 10, 红心: 20
[PlayerHealthUI] 心形0: Golden, 血量=20/20, 状态=Full
[PlayerHealthUI] 心形10: Normal, 血量=20/20, 状态=Full
```

现在血量UI完全按照你的设定工作：**所有心形20HP，金心只是视觉升级！** 🎉 